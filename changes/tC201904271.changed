Refactor Model to extract file functions